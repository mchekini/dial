version: '2'
services:
  back-1:
    build:
      context: back
      dockerfile: Dockerfile
    image: back-1
    container_name: back-1
    ports:
    - "9000:8080"
  back-2:
    build:
      context: back
      dockerfile: Dockerfile
    image: back-2
    container_name: back-2
    ports:
    - "9001:8080"
  front:
    build:
      context: front
      dockerfile: Dockerfile
    container_name: front
    image: front
    links:
    - back-1:back1
    - back-2:back2
    ports:
    - "9005:80"
    volumes:
    - ./front/src/assets/conf:/etc/nginx/conf.d/
  jenkins:
    container_name: jenkins
    image: jenkins/jenkins
    ports:
    - "9012:8080"
  postgres:
    container_name: postgres
    image: postgres
    ports:
    - "5433:5432"
    environment:
    - POSTGRES_PASSWORD=dev
  postgres-preprod:
    container_name: postgres-preprod
    image: postgres
    ports:
    - "5434:5432"
    environment:
    - POSTGRES_PASSWORD=preprod
  postgres-prod:
    container_name: postgres-prod
    image: postgres
    ports:
    - "5435:5432"
    environment:
    - POSTGRES_PASSWORD=prod
  postgres-test:
    container_name: postgres-test
    image: postgres
    ports:
    - "5436:5432"
    environment:
    - POSTGRES_PASSWORD=test
  ubuntu:
    container_name: ubuntu
    image: mchekini/ubuntu-ssh:1
    ports:
    - "30:22"
    - "9011:8080"
    tty: true
  rabbit1:
    container_name: rabbit1
    image: rabbitmq:3-management
    hostname: rabbit1
    volumes:
    - ./rabbitmq.config:/etc/rabbitmq/rabbitmq.config
    - ./definitions.json:/etc/rabbitmq/definitions.json
    environment:
    - RABBITMQ_ERLANG_COOKIE=secret string
    - RABBITMQ_NODENAME=rabbit1
    networks:
    - default
  rabbit2:
      container_name: rabbit2
      image: rabbitmq:3-management
      hostname: rabbit2
      depends_on:
      - rabbit1
      volumes:
      - ./rabbitmq.config:/etc/rabbitmq/rabbitmq.config
      - ./definitions.json:/etc/rabbitmq/definitions.json
      environment:
      - RABBITMQ_ERLANG_COOKIE=secret string
      - RABBITMQ_NODENAME=rabbit2
      networks:
      - default
      links:
      - "rabbit1:rabbit1"
  rabbit3:
    container_name: rabbit3
    image: rabbitmq:3-management
    hostname: rabbit3
    depends_on:
    - rabbit1
    - rabbit2
    volumes:
    - ./rabbitmq.config:/etc/rabbitmq/rabbitmq.config
    - ./definitions.json:/etc/rabbitmq/definitions.json
    environment:
    - RABBITMQ_ERLANG_COOKIE=secret string
    - RABBITMQ_NODENAME=rabbit3
    networks:
    - default
    links:
    - "rabbit1:rabbit1"
    - "rabbit2:rabbit2"
  lb:
    image: haproxy
    environment:
    - MODE=tcp
    links:
    - "rabbit1:rabbit1"
    - "rabbit2:rabbit2"
    - "rabbit3:rabbit3"
    volumes:
    - ./haproxy.cfg:/usr/local/etc/haproxy/haproxy.cfg
    depends_on:
    - rabbit1
    - rabbit2
    - rabbit3
    ports:
    - 15672:15672
    - 5672:5672
    networks:
    - default







networks:
  default:
    #external:
      #name: dial_default



#volumes:
#  rabbitmqstats_data:
#    driver: local

